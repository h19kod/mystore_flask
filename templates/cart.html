{% extends 'base.html' %}

{% block title %}Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª{% endblock %}

{% block content %}
<div class="container mt-5 text-end">
    <h2 class="fw-bold mb-4 border-bottom pb-3">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
    
    <div id="cart-container" class="row">
        <div class="col-md-8">
            <div class="table-responsive bg-white shadow-sm rounded-4 p-3">
                <table class="table align-middle">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="cart-items">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm border-0 rounded-4 p-4 bg-light">
                <h5 class="fw-bold mb-3">Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h5>
                <div class="d-flex justify-content-between mb-2">
                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                    <span class="fw-bold text-primary"><span id="total-price">0</span> Ø¯.Ø¹</span>
                </div>
                <hr>
                <a href="/checkout/" class="btn btn-success btn-lg w-100 rounded-pill fw-bold">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ âœ…</a>
            </div>
        </div>
    </div>
</div>

<script>
    function displayCart() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let cartTable = document.getElementById('cart-items');
        let total = 0;
        cartTable.innerHTML = '';

        if(cart.length === 0) {
            document.getElementById('cart-container').innerHTML = '<div class="text-center py-5"><h3>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© ğŸ˜…</h3><a href="/" class="btn btn-primary mt-3 rounded-pill">ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</a></div>';
            return;
        }

        cart.forEach((item, index) => {
            let itemTotal = item.price * item.quantity;
            total += itemTotal;
            cartTable.innerHTML += `
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <img src="${item.image || 'https://via.placeholder.com/50'}" class="rounded-3 ms-3" style="width: 50px; height: 50px; object-fit: cover;">
                            <span class="fw-bold">${item.name}</span>
                        </div>
                    </td>
                    <td>${item.price} Ø¯.Ø¹</td>
                    <td>${item.quantity}</td>
                    <td>${itemTotal} Ø¯.Ø¹</td>
                    <td><button class="btn btn-outline-danger btn-sm border-0" onclick="removeFromCart(${index})"><i class="fas fa-trash"></i></button></td>
                </tr>
            `;
        });
        document.getElementById('total-price').innerText = total;
    }

    function removeFromCart(index) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        displayCart();
        if (typeof updateCartBadge === "function") updateCartBadge();
    }

    displayCart();
</script>
{% endblock %}