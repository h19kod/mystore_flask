{% extends 'base.html' %}

{% block title %}Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ù…ØªØ¬Ø±ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±{% endblock %}

{% block content %}
<div class="container mt-4">

    <div id="mainSlider" class="carousel slide shadow-sm rounded-4 overflow-hidden mb-5" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#mainSlider" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#mainSlider" data-bs-slide-to="1"></button>
        </div>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <div class="bg-primary d-flex align-items-center justify-content-center text-white text-center" style="height: 350px; background: linear-gradient(45deg, #0d6efd, #0dcaf0);">
                    <div>
                        <h1 class="fw-bold display-4">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØªØ¬Ø±Ù†Ø§ âœ¨</h1>
                        <p class="lead">Ø§ÙƒØªØ´Ù Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø¨Ø£Ø³Ø¹Ø§Ø± ØªÙ†Ø§ÙØ³ÙŠØ©</p>
                    </div>
                </div>
            </div>
            <div class="carousel-item">
                <div class="bg-dark d-flex align-items-center justify-content-center text-white text-center" style="height: 350px; background: linear-gradient(45deg, #212529, #495057);">
                    <div>
                        <h1 class="fw-bold display-4">Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ© ğŸ</h1>
                        <p class="lead">ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„ÙƒØ§ÙØ© Ù…Ø­Ø§ÙØ¸Ø§Øª Ø§Ù„Ø¹Ø±Ø§Ù‚</p>
                    </div>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#mainSlider" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#mainSlider" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <div class="text-center mb-4">
        <h4 class="fw-bold mb-3">ØªØµÙØ­ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</h4>
        <div class="d-flex flex-wrap justify-content-center gap-2">
            <a href="/" class="btn btn-outline-dark rounded-pill px-4 {% if not selected_category %}active{% endif %}">Ø§Ù„ÙƒÙ„</a>
            {% for cat in categories %}
                <a href="/?category={{ cat.id }}" class="btn btn-outline-dark rounded-pill px-4 {% if selected_category == cat.id|stringformat:'i' %}active{% endif %}">
                    {{ cat.name }}
                </a>
            {% endfor %}
        </div>
    </div>

    <hr class="my-5">

    {% if query %}
        <div class="alert alert-light border shadow-sm d-flex justify-content-between align-items-center rounded-4 mb-4">
            <span class="fs-5 text-dark">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: <strong>"{{ query }}"</strong></span>
            <a href="/" class="btn btn-sm btn-secondary rounded-pill">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø­Ø« âœ–</a>
        </div>
    {% endif %}

    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for product in products %}
        <div class="col">
            <div class="card h-100 shadow-sm border-0 product-card" style="border-radius: 20px; overflow: hidden;">
                {% if product.image %}
                    <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}" style="height: 250px; object-fit: cover;">
                {% else %}
                    <div class="bg-light d-flex align-items-center justify-content-center" style="height: 250px;">
                        <i class="fas fa-image fa-3x text-muted"></i>
                    </div>
                {% endif %}

                <div class="card-body text-end">
                    <h5 class="card-title fw-bold mb-2">{{ product.name }}</h5>
                    <p class="text-muted small mb-3">{{ product.description|truncatewords:8 }}</p>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-primary fw-bold fs-5">{{ product.price }} Ø¯.Ø¹</span>
                        <a href="{% url 'product-detail' product.slug %}" class="text-decoration-none text-muted small">Ø§Ù„Ù…Ø²ÙŠØ¯..</a>
                    </div>

                    <button class="btn btn-dark w-100 rounded-pill fw-bold py-2" 
                            onclick="addToCart('{{ product.id }}', '{{ product.name }}', '{{ product.price }}', '{% if product.image %}{{ product.image.url }}{% endif %}')">
                        Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’
                    </button>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <div class="mb-3"><i class="fas fa-search fa-4x text-light"></i></div>
            <h3 class="text-muted">Ù„Ù… Ù†Ø¬Ø¯ Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª!</h3>
            <a href="/" class="btn btn-primary mt-3 rounded-pill px-4">ØªØµÙØ­ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
        </div>
        {% endfor %}
    </div>
</div>

<script>
function addToCart(id, name, price, imageUrl) {
    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø³Ù„Ø©
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    
    // 2. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬
    let existingItem = cart.find(item => item.id === id);

    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        // 3. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø©
        cart.push({
            id: id,
            name: name,
            price: parseFloat(price),
            image: imageUrl || 'https://via.placeholder.com/150', // ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯
            quantity: 1
        });
    }
    
    // 4. Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
    localStorage.setItem('cart', JSON.stringify(cart));
    if (typeof updateCartBadge === "function") updateCartBadge();

    // ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø³ÙŠØ·
    alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© ' + name + ' Ø¥Ù„Ù‰ Ø³Ù„ØªÙƒ! âœ…');
}
</script>

<style>
    .product-card { transition: all 0.3s ease-in-out; }
    .product-card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.1) !important; }
    .btn-outline-dark.active { background-color: #212529; color: white; }
</style>
{% endblock %}